<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Echo</title>
  </head>
  <body>
    <form
      id="form"
      style="
        white-space: pre-wrap;
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 8px;
        width: 400px;
        display: flex;
        justify-content: space-between;
        gap: 4px;
      "
    >
      <input
        id="input"
        placeholder="Type message..."
        style="flex: 1"
        autocomplete="off"
      />
      <button type="submit">Send</button>
    </form>
    <div
      id="text"
      style="
        white-space: pre-wrap;
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 8px;
        margin-top: 8px;
        width: 400px;
        height: 200px;
        overflow: auto;
      "
    ></div>

    <script>
      const ws = new WebSocket("ws://localhost:8080");
      const print = (value) => {
        const l = document.getElementById("text");
        l.textContent += value + "\n";
        l.scrollTop = l.scrollHeight;
      };

      ws.onopen = () => {
        print("Connected...");
      };

      ws.onmessage = (e) => {
        print(e.data);
      };

      ws.onerror = (e) => {
        print("Error: ", error);
      };

      document.getElementById("form").addEventListener("submit", (event) => {
        event.preventDefault();

        const input = document.getElementById("input");
        if (!ws || ws.readyState !== WebSocket.OPEN) {
          print("Socket not open");
          return;
        }
        const newMessage = input.value;
        if (!newMessage) return;
        ws.send(newMessage);
        print("> " + newMessage);
        input.value = "";
      });
    </script>
  </body>
</html>
